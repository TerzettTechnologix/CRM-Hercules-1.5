const algoritmoCalcular=document.querySelector("#algoritmo"),clienteEtiqueta=document.querySelector("#cliente"),idProvedor=document.querySelector("#idProvedor"),nombreSolicitado=document.querySelector("#nombreSolicitado"),valorPeso=document.querySelector("#valorPeso"),valorDolarPeso=document.querySelector("#valorDolarPeso"),tipoAdquision=document.querySelector("#tipoAdquisicion"),credito=document.querySelector("#credito"),transporte=document.querySelector("#transporte"),porcentajeCredito=document.querySelector("#porcentajeCredito"),numeroItems=document.querySelector("#numeroItems"),parteSuperior=document.querySelector(".card-title"),gasOpe=document.querySelector("#gasOpe"),utiVen=document.querySelector("#utiVen"),cosEmp=document.querySelector("#cosEmp"),marNeg=document.querySelector("#marNeg"),suma=document.querySelector("#suma"),flete=document.querySelector("#costoFlete"),diasHabiles=document.querySelector("#diasHabiles"),numeroMaximo=document.querySelector("#numeroMaximo"),costoItem=document.querySelector("#costoItem"),botonSalvar=document.querySelector("#btnSalvar"),idTransaccion=document.querySelector("#idVenta"),FechaLabel=document.querySelector("#Fecha").value;clienteBecton=["Seleccione un nombre","ALEXIS CUEVAS","ERNESTO  CERILLO","CHRISTIAN ÁVALOS","CARLOS ORTEGA","ARTURO FERREIRA","ADRIAN GARCIA","ALBERTO LOPEZ GOVEA","ALBERTO LOPEZ LOPEZ","ALDO VILLALOBOS","ALONSO PINEDA","ANDROS ALARCON","ANGEL MELGAREJO","BRAULIO BONIFACIO","CESAR CAMARGO","CESAR GOMEZ","CRISTINA MARIA FERNANDA TINOCO","DAVID MEZA","DENNIS ALI PEÑALOZA","DENSY ENRIQUEZ","EDGAR MAFRA","EDGAR VILLAREAL","EDUARDO PACHECO","ELIAS GONZALES","FERNANDO ALICON BELLO","FERNANDO GARCIA","FERNANDO GONZALEZ LEIVA","FERNANDO TELLO","FIDEL CALLEJAS","FRANCISCO SHERATON","GASPAR RAMIREZ","GERARDO PINO","GERARDO TOVAR","GERMAN GARCIA","HECTOR PINO","HUGO REGALADO","JOSUE ZAVALA","IRVING CORTES ATENO","ISRAEL AGUILAR","ISRAEL CALDERILLA","JOEL GAUCIN","JOSE GUADALUPE ORTIZ","JOSE LUIS ORTIZ JIMENEZ","JOSE LUIS RIVAS","JUAN MARTINEZ","JUAN NAVA MORENO","JUAN PABLO BAUTISTA","JUAN RIVERA","JULIO HERNANDEZ","JUSTO PEREZ","LUIS FRANCISCO MARTINEZ","LUIS TRANQUILINO","MARIO MORENO","MARIO NIETO","MATEO MONRROY","MARTIN ARTEAGA","MAURICIO MORALES MONROY","MIGUEL LOPEZ","MIGUEL MARQUEZ","MIGUEL RAMIREZ","JUAN MIGUEL SALGADO","OCTAVIO JURADO","OSCAR CONTRERAS","OSCAR FUENTES","RAMSES BASURTO","ROGELIO DOMINGUEZ","ROSA M PABLO","RUBEN ZAMORA","SAIRI MATLALCUATZI LEÓN","SALVADOR CENTENO","SANTIAGO CASTELLANO","VICTOR HUGO AVENDAÑO","VICTOR VILLAR","RUBEN AYALA","IGNACIO REGINO","JESÚS CEDEÑO","FERNANDO RAMÍRREZ","ERICK BARRERA","ADRIAN LOSANO","ANUAR SAID CALZADA","RAMSES BASURTO","LIZA PAOLA LOPEZ","RUBEN ROJAS ZAMORA","JOSE FERNANDO VARELA","JEANNETTE CARDENAS","JOEL GAUCIN","OSCAR CONTRERAS","EMMANUEL HERNANDEZ TRUJILLO","MARÍA DELIA GRACIDA","JESUS DANIEL CEDEÑO","JESUS GONZALEZ MORENO","ADRIAN SOLANO","FERNANDO GONZALEZ","JOSE MANUEL PEREZ","GUSTAVO MARTÍN RIZO","FERNANDO EMMANUEL RAMIREZ","FRANCISCO JAVIER GARCIA","SALVADOR CENTENO","LILIAN TORRES","ROSA AVILA","GABRIELA CARMONA / XIMENA","LILIAN RODRIGUEZ","FERNANDO RAMIREZ","MARIA DELIA GRACIDA","JULIO FLORES","MARIA CRISTINA HERRERA ALMEIDA"],clienteTritec=["Seleccione un nombre","Mario Gutiérrez"],clienteCeralto=["Seleccione un nombre","Rubén Leal","Sergio Barreto"],clienteDHL=["Seleccione un nombre","Julio César Martínez Avendaño","Óscar Marino,Gerardo Martínez"],clienteATD=["Seleccione un nombre","Claudia Sanabria"],clienteBritish=["Seleccione un nombre","Juan Carlos Martinez"],algoritmo=["Seleccione un nombre","Ventas","Manofactura","Urgencia Venta","Urgencia Manofactura"];const Tabulador={Ventas:{GastoOperativo:20,UtilidadVendedo:3,CosteEmpresa:18,MargenNegociacion:10},Manofactura:{GastoOperativo:25,UtilidadVendedo:3,CosteEmpresa:25,MargenNegociacion:18},UrgenciaVenta:{GastoOperativo:35,UtilidadVendedo:5,CosteEmpresa:40,MargenNegociacion:15},UrgenciaManofactura:{GastoOperativo:50,UtilidadVendedo:5,CosteEmpresa:50,MargenNegociacion:25}},opciones={algoritmo:"",cliente:"",provedor:"",clienteNombre:"",valorPeso:"",valorPesoDolar:"",adquisicion:"",credito:"",transporte:"",creditoPorcentaje:"",items:0,gastoOperativo:"",utilidadVendedor:"",costeEmpresa:"",margenNegociacion:"",sumaPorcentaje:"",flete:"",costoPorItem:"",diasHabiles:"",diasMaximos:"",numeroVenta:"",fecha:FechaLabel};function consultar(){algoritmoCalcular.addEventListener("change",(function(){const e=document.querySelector("#algoritmo").value;opciones.algoritmo=e,asignarAlgoritmo(parseInt(opciones.algoritmo)),asignarTabulador(opciones.gastoOperativo,opciones.utilidadVendedor,opciones.margenNegociacion)}))}function Obtenercliente(){clienteEtiqueta.addEventListener("change",(function(){opciones.cliente=clienteEtiqueta.value,asignarCliente(parseInt(opciones.cliente)),asignarIDProvedor(opciones.cliente),asignarValor(credito,opciones.credito+" días"),asignarValor(transporte,`$${opciones.transporte} MXM`),asignarValor(porcentajeCredito,opciones.creditoPorcentaje+"%"),asignarCosteEmpresa(opciones.costeEmpresa,opciones.creditoPorcentaje),sumarPorcentajes(opciones)}))}function asignarIDProvedor(e){switch(e){case"Becton Dickinson":opciones.provedor="0001319780",asignarNombreProvedor(clienteBecton);break;case"Tritec LLC":opciones.provedor="TTE1704047U8",asignarNombreProvedor(clienteTritec);break;case"Cerealto Siro":opciones.provedor="14404",asignarNombreProvedor(clienteCeralto);break;case"DHL":opciones.provedor="339724",asignarNombreProvedor(clienteDHL);break;case"ATD Sensores":opciones.provedor="TTE1704047U8",asignarNombreProvedor(clienteATD);break;case"British American Tobacco":opciones.provedor="2896807",asignarNombreProvedor(clienteBritish)}asignarValor(idProvedor,""+opciones.provedor)}function asignarAlgoritmo(e){switch(e){case 1:return opciones.algoritmo="Venta",opciones.gastoOperativo=Tabulador.Ventas.GastoOperativo,opciones.utilidadVendedor=Tabulador.Ventas.UtilidadVendedo,opciones.costeEmpresa=Tabulador.Ventas.CosteEmpresa,void(opciones.margenNegociacion=Tabulador.Ventas.MargenNegociacion);case 2:return opciones.algoritmo="Manofactura",opciones.gastoOperativo=Tabulador.Manofactura.GastoOperativo,opciones.utilidadVendedor=Tabulador.Manofactura.UtilidadVendedo,opciones.costeEmpresa=Tabulador.Manofactura.CosteEmpresa,void(opciones.margenNegociacion=Tabulador.Manofactura.MargenNegociacion);case 3:return opciones.algoritmo="Urgencia Venta",opciones.gastoOperativo=Tabulador.UrgenciaVenta.GastoOperativo,opciones.utilidadVendedor=Tabulador.UrgenciaVenta.UtilidadVendedo,opciones.costeEmpresa=Tabulador.UrgenciaVenta.CosteEmpresa,void(opciones.margenNegociacion=Tabulador.UrgenciaVenta.MargenNegociacion);case 4:opciones.algoritmo="Urgencia Manofactura",opciones.gastoOperativo=Tabulador.UrgenciaManofactura.GastoOperativo,opciones.utilidadVendedor=Tabulador.UrgenciaManofactura.UtilidadVendedo,opciones.costeEmpresa=Tabulador.UrgenciaManofactura.CosteEmpresa,opciones.margenNegociacion=Tabulador.UrgenciaManofactura.MargenNegociacion;default:return}}function asignarCliente(e){switch(e){case 1:opciones.cliente="Becton Dickinson",opciones.credito=60,opciones.transporte=71,opciones.creditoPorcentaje=4;break;case 2:opciones.cliente="Tritec LLC",opciones.credito=5,opciones.transporte=71,opciones.creditoPorcentaje=.333;break;case 3:opciones.cliente="Cerealto Siro",opciones.credito=30,opciones.transporte=413,opciones.creditoPorcentaje=2;break;case 4:opciones.cliente="DHL",opciones.credito=60,opciones.transporte=1691,opciones.creditoPorcentaje=4;break;case 5:opciones.cliente="ATD Sensores",opciones.credito=5,opciones.transporte=910,opciones.creditoPorcentaje=.333;break;case 6:opciones.cliente="British American Tobacco",opciones.credito=60,opciones.transporte=19525,opciones.creditoPorcentaje=4}}function asignarNombreProvedor(e){limpiarOpcionCLiente(),e.forEach(e=>{const o=document.createElement("option");o.name="nombrePersona",o.value=e,o.textContent=e,nombreSolicitado.appendChild(o)}),leerNombreSolicitado()}function limpiarOpcionCLiente(){for(;nombreSolicitado.firstChild;)nombreSolicitado.removeChild(nombreSolicitado.firstChild)}function leerNombreSolicitado(){nombreSolicitado.addEventListener("change",(function(){opciones.clienteNombre=nombreSolicitado.value}))}async function consultarPesoHoy(){try{const e=await fetch("https://cdn.jsdelivr.net/gh/fawazahmed0/currency-api@1/latest/currencies/usd.json");colocarPesoMexicano((await e.json()).usd.mxn)}catch(e){console.log(e)}}function obtenerAdquision(){tipoAdquision.addEventListener("change",(function(){opciones.adquisicion=tipoAdquision.value,asignarAdquision(parseInt(opciones.adquisicion))}))}function crearError(e){const o=document.createElement("p");o.textContent=e,o.classList.add("alert","alert-danger","text-white","m-3"),parteSuperior.appendChild(o),setTimeout(()=>{o.remove()},7e3)}function asignarAdquision(e){switch(e){case 1:opciones.adquisicion="Salvo previa Venta";break;case 2:opciones.adquisicion="Stock";break;case 3:opciones.adquisicion="A tiempo de entrega"}}function asignarValor(e,o){e.innerHTML=o,e.classList.add("text-center")}function asignarTabulador(e,o,a){gasOpe.innerHTML=e+" %",gasOpe.classList.add("text-center"),utiVen.innerHTML=o+" %",utiVen.classList.add("text-center"),marNeg.innerHTML=a+" %",marNeg.classList.add("text-center")}function sumarPorcentajes(e){const{gastoOperativo:o,utilidadVendedor:a,costeEmpresa:n,margenNegociacion:r,creditoPorcentaje:i}=e;let t=o+a+n+r+i;suma.classList.add("text-center"),suma.innerHTML=t+" %",e.sumaPorcentaje=t}function asignarCosteEmpresa(e,o){let a=e+o;asignarValor(cosEmp,a+" %"),opciones.costeEmpresa=a}function colocarPesoMexicano(e){asignarValor(valorPeso,e+" MXM"),opciones.valorPeso=e,calcularvalorDolar()}function calcularvalorDolar(){opciones.valorPesoDolar=1.07*opciones.valorPeso,asignarValor(valorDolarPeso,opciones.valorPesoDolar+" MXM")}function obtenerNumeroItems(){let e=parseInt(numeroItems.value);opciones.items=e,(!opciones.items||opciones.items<0)&&crearError("Contenido de items incorrecto, vuelve a intentarlo")}function obtenerFlete(){let e=parseInt(flete.value);opciones.flete=e,!opciones.items||opciones.items<0||isNaN(opciones.flete)?crearError("La cantidad de items no puede ir vacia o se escribio un valor no valido en flete, vuelve a intentarlo"):(opciones.flete=e,calcularCosteTransporte(opciones))}function obtenerDiasHabiles(){let e=parseInt(diasHabiles.value);opciones.diasHabiles=e,(!opciones.diasHabiles||opciones.diasHabiles<0)&&crearError("No se inserto un valor valido para los días")}function obtenerTiempoEntrega(){let e=parseInt(numeroMaximo.value);opciones.diasMaximos=e,(!opciones.diasMaximos||opciones.diasMaximos<0)&&crearError("No se inserto un valor valido para los días máximos de entrega")}function obtenerIdVenta(){let e=parseInt(idTransaccion.value);opciones.numeroVenta=e,(!opciones.numeroVenta||opciones.numeroVenta<0)&&crearError("No se inserto un valor valido para el numero de venta")}function calcularCosteTransporte(e){const{transporte:o,items:a,flete:n}=e;if("0"==n){let n=o/a;return e.costoPorItem=n,void asignarValor(costoItem,"$"+n)}let r=n/a;e.costoPorItem=r,asignarValor(costoItem,"$"+r)}function guardarResultados(e){e.preventDefault();const{algoritmo:o,cliente:a,clienteNombre:n,adquisicion:r,items:i,flete:t,diasHabiles:c,diasMaximos:s,costoPorItem:d,numeroVenta:l}=opciones;0!=o.length&&0!=a.length&&0!=n.length&&0!=r.length&&0!=d.length&&0!=i.length&&0!=t.length&&0!=c.length&&0!=s.length&&0!=idVenta.length?isNaN(c)||isNaN(s)||isNaN(t)||isNaN(i)||isNaN(l)?crearError("Se insertaron valores invalidos, en las cajas de texto"):enviarAjax(opciones):crearError("Todos los valores son obligatorios o se insertaron valores invalidos")}async function enviarAjax(e){const{algoritmo:o,cliente:a,provedor:n,clienteNombre:r,valorPeso:i,valorPesoDolar:t,adquisicion:c,credito:s,transporte:d,creditoPorcentaje:l,items:p,gastoOperativo:A,utilidadVendedor:u,costeEmpresa:E,margenNegociacion:m,sumaPorcentaje:O,flete:N,costoPorItem:R,diasHabiles:I,diasMaximos:g,numeroVenta:L}=e,S=new FormData;S.append("algoritmo",o),S.append("cliente",a),S.append("provedor",n),S.append("clienteNombre",r),S.append("valorPeso",i),S.append("valorPesoDolar",t),S.append("adquisicion",c),S.append("credito",s),S.append("transporte",d),S.append("creditoPorcentaje",l),S.append("item",p),S.append("gastoOperativo",A),S.append("utilidadVendedor",u),S.append("costeEmpresa",E),S.append("margenNegociacion",m),S.append("sumaPorcentaje",O),S.append("flete",N),S.append("costoPorItem",R),S.append("diasHabiles",I),S.append("diasMaximos",g),S.append("numeroVenta",L),S.append("fecha",fecha);await fetch("/admin/api/propuesta-leer",{method:"POST",body:S})}document.addEventListener("DOMContentLoaded",()=>{consultarPesoHoy(),consultar(),Obtenercliente(),obtenerAdquision(),numeroItems.addEventListener("blur",obtenerNumeroItems),flete.addEventListener("blur",obtenerFlete),diasHabiles.addEventListener("blur",obtenerDiasHabiles),numeroMaximo.addEventListener("blur",obtenerTiempoEntrega),botonSalvar.addEventListener("click",guardarResultados),idTransaccion.addEventListener("blur",obtenerIdVenta)});